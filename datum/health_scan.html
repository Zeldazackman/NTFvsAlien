<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><base href="../"><link rel="stylesheet" href="dmdoc.css"><title>/datum/health_scan - byond</title></head><body><header><a href="index.html">byond</a> - <a href="index.html#modules">Modules</a> - <a href="index.html#types">Types</a> — <a href="datum/health_scan.html#var">Var Details</a> - <a href="datum/health_scan.html#proc">Proc Details</a></header><main><h1>health_scan <aside>/<a href="datum.html">datum</a>/<a href="datum/health_scan.html">health_scan</a></aside> <a href="https://github.com/Zeldazackman/NTFvsAlien/blob/5afaf750b713b008001fd407fbc42fb5cfc7d171/code/datums/health_scan/health_scan.dm#L23"><img src="git.png" width="16" height="16" title="code/datums/health_scan/health_scan.dm 23"></a></h1><p>An evil, no-good component-like datum for health analyzer functionality.</p>
<p>We have a couple things that want to use health analyzer functionality, from the health
analyzer object to ghosts and analyzer gloves so this is here to share it between all of them
in a slightly saner way than giving everything a health analyzer obj.</p>
<p>This may not be parented to non-atoms. It needs to have something in-world parenting it.</p>
<p>Example usage:</p>
<pre><code class="language-dm">/obj/item/abhorrent_item
	...
	var/datum/health_scan/scanner

/obj/item/abhorrent_item/Initialize(mapload)
	scanner = new(src)

/obj/item/abhorrent_item/attack_self(mob/living/carbon/human/user)
	scanner.analyze_vitals(user, user)
</code></pre><table class="summary" cellspacing="0"><tr><td colspan="2"><h2>Vars</h2></td></tr><tr><th><a href="datum/health_scan.html#var/allow_live_autoupdating">allow_live_autoupdating</a></th><td>Var for if we should set autoupdating in <a href="datum.html#proc/ui_status" title="/datum">/datum/health_scan/ui_status</a> at all.
Check the comment in that proc for more, but basically tgui's system for managing autoupdating
is far too vague for what we're doing. We have to use a workaround to avoid dimming the UI and closing it.
This var can't disable autoupdates in the first place—set <code>track_distance</code> to <a href="code/__DEFINES/health_scan.html#define/TRACK_DISTANCE_DISABLED" title="TRACK_DISTANCE_DISABLED">TRACK_DISTANCE_DISABLED</a> for that.</td></tr><tr><th><a href="datum/health_scan.html#var/owner">owner</a></th><td>The atom we will use for autoupdate tracking.
This cannot be anything other than an atom. Even if this datum is being used
in a component, you need to set this to the atom parenting that component.</td></tr><tr><th><a href="datum/health_scan.html#var/patient">patient</a></th><td>Current mob being tracked by the scanner.</td></tr><tr><th><a href="datum/health_scan.html#var/show_scan_cooldown">show_scan_cooldown</a></th><td>Cooldown for showing a scan to somebody.</td></tr><tr><th><a href="datum/health_scan.html#var/skill_threshold">skill_threshold</a></th><td>Skill required to bypass the fumble time.</td></tr><tr><th><a href="datum/health_scan.html#var/track_distance">track_distance</a></th><td>Distance the user can be away from the patient and still get autoupdates.
Set to <a href="code/__DEFINES/health_scan.html#define/TRACK_DISTANCE_DISABLED" title="TRACK_DISTANCE_DISABLED">TRACK_DISTANCE_DISABLED</a> to disable autoupdating entirely.</td></tr><tr><th><a href="datum/health_scan.html#var/upper_skill_threshold">upper_skill_threshold</a></th><td>Skill required to have the scanner auto refresh.</td></tr><tr><td colspan="2"><h2>Procs</h2></td></tr><tr><th><a href="datum/health_scan.html#proc/New">New</a></th><td>New proc, with some args for controlling usage of this</td></tr><tr><th><a href="datum/health_scan.html#proc/analyze_vitals">analyze_vitals</a></th><td>A wrapper proc, so this datum can be used by signals/its parent/whatever.
Do not call <code>ui_interact</code> directly.</td></tr><tr><th><a href="datum/health_scan.html#proc/autoupdate_checks">autoupdate_checks</a></th><td>If <code>user</code> is too unskilled, not on the same tile as <code>owner</code>, <code>user</code> is out of tracking range,
or it's a self scan, we return <code>FALSE</code>.</td></tr><tr><th><a href="datum/health_scan.html#proc/clear_patient">clear_patient</a></th><td>Signal handler to clear the patient and close the UI in the very specific
(but not uncommon) case of tracking a patient who gets gibbed or otherwise deleted.</td></tr><tr><th><a href="datum/health_scan.html#proc/on_examine">on_examine</a></th><td>Examine note about accessible themes preference</td></tr></table><h2 id="var">Var Details</h2><h3 id="var/allow_live_autoupdating"><aside class="declaration">var </aside>allow_live_autoupdating <a href="https://github.com/Zeldazackman/NTFvsAlien/blob/5afaf750b713b008001fd407fbc42fb5cfc7d171/code/datums/health_scan/health_scan.dm#L28"><img src="git.png" width="16" height="16" title="code/datums/health_scan/health_scan.dm 28"></a></h3><p>Var for if we should set autoupdating in <a href="datum.html#proc/ui_status" title="/datum">/datum/health_scan/ui_status</a> at all.
Check the comment in that proc for more, but basically tgui's system for managing autoupdating
is far too vague for what we're doing. We have to use a workaround to avoid dimming the UI and closing it.
This var can't disable autoupdates in the first place—set <code>track_distance</code> to <a href="code/__DEFINES/health_scan.html#define/TRACK_DISTANCE_DISABLED" title="TRACK_DISTANCE_DISABLED">TRACK_DISTANCE_DISABLED</a> for that.</p><h3 id="var/owner"><aside class="declaration">var </aside>owner <aside>– /<a href="atom.html">atom</a></aside> <a href="https://github.com/Zeldazackman/NTFvsAlien/blob/5afaf750b713b008001fd407fbc42fb5cfc7d171/code/datums/health_scan/health_scan.dm#L34"><img src="git.png" width="16" height="16" title="code/datums/health_scan/health_scan.dm 34"></a></h3><p>The atom we will use for autoupdate tracking.
This cannot be anything other than an atom. Even if this datum is being used
in a component, you need to set this to the atom parenting that component.</p><h3 id="var/patient"><aside class="declaration">var </aside>patient <aside>– /<a href="mob.html">mob</a>/<a href="mob/living.html">living</a>/<a href="mob/living/carbon.html">carbon</a>/<a href="mob/living/carbon/human.html">human</a></aside> <a href="https://github.com/Zeldazackman/NTFvsAlien/blob/5afaf750b713b008001fd407fbc42fb5cfc7d171/code/datums/health_scan/health_scan.dm#L30"><img src="git.png" width="16" height="16" title="code/datums/health_scan/health_scan.dm 30"></a></h3><p>Current mob being tracked by the scanner.</p><h3 id="var/show_scan_cooldown"><aside class="declaration">var </aside>show_scan_cooldown <a href="https://github.com/Zeldazackman/NTFvsAlien/blob/5afaf750b713b008001fd407fbc42fb5cfc7d171/code/datums/health_scan/health_scan.dm#L43"><img src="git.png" width="16" height="16" title="code/datums/health_scan/health_scan.dm 43"></a></h3><p>Cooldown for showing a scan to somebody.</p><h3 id="var/skill_threshold"><aside class="declaration">var </aside>skill_threshold <a href="https://github.com/Zeldazackman/NTFvsAlien/blob/5afaf750b713b008001fd407fbc42fb5cfc7d171/code/datums/health_scan/health_scan.dm#L36"><img src="git.png" width="16" height="16" title="code/datums/health_scan/health_scan.dm 36"></a></h3><p>Skill required to bypass the fumble time.</p><h3 id="var/track_distance"><aside class="declaration">var </aside>track_distance <a href="https://github.com/Zeldazackman/NTFvsAlien/blob/5afaf750b713b008001fd407fbc42fb5cfc7d171/code/datums/health_scan/health_scan.dm#L41"><img src="git.png" width="16" height="16" title="code/datums/health_scan/health_scan.dm 41"></a></h3><p>Distance the user can be away from the patient and still get autoupdates.
Set to <a href="code/__DEFINES/health_scan.html#define/TRACK_DISTANCE_DISABLED" title="TRACK_DISTANCE_DISABLED">TRACK_DISTANCE_DISABLED</a> to disable autoupdating entirely.</p><h3 id="var/upper_skill_threshold"><aside class="declaration">var </aside>upper_skill_threshold <a href="https://github.com/Zeldazackman/NTFvsAlien/blob/5afaf750b713b008001fd407fbc42fb5cfc7d171/code/datums/health_scan/health_scan.dm#L38"><img src="git.png" width="16" height="16" title="code/datums/health_scan/health_scan.dm 38"></a></h3><p>Skill required to have the scanner auto refresh.</p><h2 id="proc">Proc Details</h2><h3 id="proc/New">New<aside>(/<a href="atom.html">atom</a>/scan_owner, skill_bypass_fumble, skill_auto_update, autoupdate_distance)  <a href="https://github.com/Zeldazackman/NTFvsAlien/blob/5afaf750b713b008001fd407fbc42fb5cfc7d171/code/datums/health_scan/health_scan.dm#L53"><img src="git.png" width="16" height="16" title="code/datums/health_scan/health_scan.dm 53"></a></aside></h3><p>New proc, with some args for controlling usage of this</p>
<ul>
<li><code>scan_owner</code>—The atom that <em>owns</em> this. Needed for balloon alerts and autoupdates.</li>
<li><code>skill_bypass_fumble</code>—The Medical skill needed to not fumble with this.</li>
<li><code>skill_auto_update</code>—The Medical skill needed to get autoupdates with this.</li>
<li><code>track_distance</code>—The distance (tiles) before autoupdating is locked until rescanning.</li>
</ul><h3 id="proc/analyze_vitals"><aside class="declaration">proc </aside>analyze_vitals<aside>(/<a href="mob.html">mob</a>/<a href="mob/living.html">living</a>/<a href="mob/living/carbon.html">carbon</a>/<a href="mob/living/carbon/human.html">human</a>/patient_candidate, /<a href="mob.html">mob</a>/user, show_patient)  <a href="https://github.com/Zeldazackman/NTFvsAlien/blob/5afaf750b713b008001fd407fbc42fb5cfc7d171/code/datums/health_scan/health_scan.dm#L123"><img src="git.png" width="16" height="16" title="code/datums/health_scan/health_scan.dm 123"></a></aside></h3><p>A wrapper proc, so this datum can be used by signals/its parent/whatever.
Do not call <code>ui_interact</code> directly.</p>
<ul>
<li><code>patient_candidate</code>—Only carbon humans are supported. This is who we will be scanning.</li>
<li><code>user</code>—Any mob is supported. This is who the scan is shown to, unless <code>show_patient</code> is active.</li>
<li><code>show_patient</code>—If this is TRUE, we'll show the scan to <code>patient_candidate</code> instead of <code>user</code>.</li>
</ul><h3 id="proc/autoupdate_checks"><aside class="declaration">proc </aside>autoupdate_checks<aside>(/<a href="mob.html">mob</a>/<a href="mob/living.html">living</a>/user, /<a href="mob.html">mob</a>/<a href="mob/living.html">living</a>/patient)  <a href="https://github.com/Zeldazackman/NTFvsAlien/blob/5afaf750b713b008001fd407fbc42fb5cfc7d171/code/datums/health_scan/health_scan.dm#L102"><img src="git.png" width="16" height="16" title="code/datums/health_scan/health_scan.dm 102"></a></aside></h3><p>If <code>user</code> is too unskilled, not on the same tile as <code>owner</code>, <code>user</code> is out of tracking range,
or it's a self scan, we return <code>FALSE</code>.</p>
<p>Otherwise, we return <code>TRUE</code>.</p><h3 id="proc/clear_patient"><aside class="declaration">proc </aside>clear_patient<aside>(force)  <a href="https://github.com/Zeldazackman/NTFvsAlien/blob/5afaf750b713b008001fd407fbc42fb5cfc7d171/code/datums/health_scan/health_scan.dm#L91"><img src="git.png" width="16" height="16" title="code/datums/health_scan/health_scan.dm 91"></a></aside></h3><p>Signal handler to clear the patient and close the UI in the very specific
(but not uncommon) case of tracking a patient who gets gibbed or otherwise deleted.</p>
<p>We don't null patient when autoupdate disables because of our workarounds
with autoupdating—that causes runtimes every time autoupdating is disabled.
Instead, we keep the patient in mind (until another one is scanned) but listen
for their deletion and only then close the UI and null the patient var.</p>
<p>This may not seem ideal and is a consequence of bending tgui in unforeseen ways, but better than incessant runtimes.</p><h3 id="proc/on_examine"><aside class="declaration">proc </aside>on_examine<aside>(/<a href="atom.html">atom</a>/source, /<a href="mob.html">mob</a>/user, /list/examine_list)  <a href="https://github.com/Zeldazackman/NTFvsAlien/blob/5afaf750b713b008001fd407fbc42fb5cfc7d171/code/datums/health_scan/health_scan.dm#L74"><img src="git.png" width="16" height="16" title="code/datums/health_scan/health_scan.dm 74"></a></aside></h3><p>Examine note about accessible themes preference</p></main><footer>tgmc.dme <a href="https://github.com/Zeldazackman/NTFvsAlien/tree/5afaf750b713b008001fd407fbc42fb5cfc7d171">5afaf75</a> (master) — <a href="https://github.com/SpaceManiac/SpacemanDMM/blob/master/crates/dmdoc/README.md">dmdoc 1.11.0</a></footer></body></html>